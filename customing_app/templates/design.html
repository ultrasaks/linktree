{% extends 'base_new.html' %}
{% load static %}

{% block header %}

<style>
    .ava-circle {
        padding: 2rem;
        background: #e4dfdf;
        border-radius: 2rem;
        justify-content: center;
        display: flex;
        align-items: center;
        font-weight: 700;
        font-size: 1.5rem;
    }
    .profile-top {
        display: flex;
        box-sizing: border-box;
        width: 100%;
        justify-content: space-between;
        margin-bottom: 1rem;
    }
    .profile-top .buttons {
        display: flex;
        flex-direction: column;
        min-width: 50%;
        box-sizing: border-box;
    }
    .profile-top .buttons .button {
        width: 100%;
        margin-bottom: 0.5rem;
    }
    .profile-middle {
        display: flex;
        flex-direction: column;
    }
    .profile-middle input {
        margin-bottom: .5rem;
    }
    .btn-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
    }
    .btn-sample {
        color: white;
        background: black;
    }
    .btn-row .button {
        flex-grow: 1;
        margin: 0.5rem 1rem;
    }
    .btn-sq {
        border-radius: 0rem;
    }
    .btn-semi {
        border-radius: 0.5rem;
    }
    .btn-outline {
        background: white;
        outline: black 2px solid;
    }
    .btn-soft-shadow {
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.15);
        background: white;
        color: black;
    }
    .btn-hard-shadow {
        box-shadow: 5px 5px 0px #000;
        transition-duration: 0s;
    }
    .btn-hard-shadow:hover {
        transform: translate(2px, 2px);
        box-shadow: 3px 3px 0px #000;
    }
    @media (max-width: 800px) {
        .btn-row {
            flex-direction: column;
            align-items: center;
            justify-content: initial;
        }
        .btn-row .button {
            width: 100%;
        }
    }
    /* .color-square {
        width: 4rem;
        height: 4rem;
        background: red;
        border-radius: .5rem;
        margin-right: 1rem;
    } */
    .color-description {
        display: flex;
        flex-direction: column;
        background: #efebde;
        border-radius: .5rem;
        padding: .7rem 10rem 1rem 1rem;
    }
    .color-description h6 {
        margin: 0;
        position: absolute;
    }
    .color-description .color {
        margin-top: 1rem
    }
    .color-wrapper {
        display: flex;
        align-items: center;
    }
    /* input[type=text] {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 1.5rem;
        background-color: #f5efe4;
        font-size: 110%;
        font-weight: 500;
        color: #0c0c0b;
        transition-duration: .21s;
        outline: 1px transparent solid;
    }

    input[type=text]:focus {
        outline: 1px #F4CA16 solid;
    } */
    input[type=color] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none; 
        background-color: transparent;
        border: none;
        cursor: pointer;
        width: 4rem;
        height: 4rem;
        padding: 0;
        margin: 0;
        margin-right: 1rem;
        box-sizing: border-box;
    }
    .colorsss::-webkit-color-swatch{
        border-radius: .5rem;
        border: none;
    }
    .colorsss::-moz-color-swatch{
        border-radius: .5rem;
        border: none;
    }
    .outlined-selector {
        background: transparent;
        border-radius: .5rem;
        border: 2px #F4CA16 solid;
        position: absolute;
        left: -9999px;
    }
    .s {
        transform: none!important;
    }
</style>

<div class="popup hid" id="font-popup">
    <div class="card">
        <i class="ti ti-x card-icon close-btn" onclick="javascript:close_popups()"></i>
        <div class="card">Аа СПИСОК ШРИФТОВ</div>
    </div>
</div>

<div class="popup hid" id="color-popup">
    <div class="card">
        <i class="ti ti-x card-icon close-btn" onclick="javascript:close_popups()"></i>
        
    </div>
</div>


{% endblock %}

{% block content %}

{% if scheme == None %}

<h1 class="edit-heading">Ещё чуть-чуть</h1>
<div class="center-div">
    <div class="card">
        <h3>Выберите цветовую схему</h3>
        <a class="edit-link login-input" id="emp">
            <p class="edit-p">
                Стандартная
            </p>
        </a>
        <a class="edit-link login-input" id="own">
            <p class="edit-p">
                Моя собственная
            </p>
        </a>
    </div>
</div>
{% else %}

<div class="outlined-selector"></div>
<div class="card-list">
    <h3>Профиль</h3>
    <div class="card">
        <div class="profile-top">
            <div class="ava-circle">
                <img class="hid">
                <avaname>{{profile.name.0.upper}}</avaname>
            </div>
            <div class="buttons">
                <div class="button">Выбрать изображение</div>
                <div class="button">Удалить</div>
            </div>
        </div>
        <div class="profile-middle">
            <input type="text" placeholder="Имя" id="username" value="{{profile.name}}">
            <input type="text" placeholder="Описание" id="about" value="{{profile.about}}">
        </div>
        <div class="profile-bottom"></div>
    </div>


    <h3>Фон</h3>
    <div class="card">
        <div class="background-row">
            <div class="background-chose"></div>
            <div class="background-chose"></div>
            <div class="background-chose"></div>
            <div class="background-chose"></div>
        </div>
        <div class="background-row">
            <div class="background-chose"></div>
            <div class="background-chose"></div>
            <div class="background-chose"></div>
            <div class="background-chose"></div>
        </div>
    </div>

    <h3>Кнопки</h3>
    <div class="card">
        <h4>Заливка</h4>
        <div class="btn-row">
            <div class="s button btn-sample btn-sq" id="s1-1">&nbsp;</div>
            <div class="s button btn-sample btn-semi" id="s1-2">&nbsp;</div>
            <div class="s button btn-sample" id="s1-3">&nbsp;</div>
        </div>
        <h4>Обводка</h4>
        <div class="btn-row">
            <div class="s button btn-sq btn-outline" id="s2-1">&nbsp;</div>
            <div class="s button btn-semi btn-outline" id="s2-2">&nbsp;</div>
            <div class="s button btn-outline" id="s2-3">&nbsp;</div>
        </div>
        <h4>Мягкая тень</h4>
        <div class="btn-row">
            <div class="s button btn-sample btn-soft-shadow btn-sq" id="s3-1">&nbsp;</div>
            <div class="s button btn-sample btn-soft-shadow btn-semi" id="s3-2">&nbsp;</div>
            <div class="s button btn-sample btn-soft-shadow" id="s3-3">&nbsp;</div>
        </div>
        <h4>Жёсткая тень</h4>
        <div class="btn-row">
            <div class="s button btn-sample btn-outline btn-hard-shadow btn-sq" id="s4-1">&nbsp;</div>
            <div class="s button btn-sample btn-outline btn-hard-shadow btn-semi" id="s4-2">&nbsp;</div>
            <div class="s button btn-sample btn-outline btn-hard-shadow" id="s4-3">&nbsp;</div>
        </div>

        <h4>Цвет тени</h4>
        <div class="color-wrapper">
            <input type="color" class="colorsss" id="shadow-color-input" value="{{scheme.shadow}}">
            <div class="color-description">
                <h6>Color</h6>
                <div class="color" id="shadow-color-input-text">{{scheme.shadow}}</div>
            </div>
        </div>

        <h4>Цвет кнопки</h4>
        <div class="color-wrapper">
            <input type="color" class="colorsss" id="button-color-input" value="{{scheme.button}}">
            <div class="color-description">
                <h6>Color</h6>
                <div class="color" id="button-color-input-text">{{scheme.button}}</div>
            </div>
        </div>
        
        <h4>Обводка кнопки</h4>
        <div class="color-wrapper">
            <input type="color" class="colorsss" id="outline-color-input" value="{{scheme.outline}}">
            <div class="color-description">
                <h6>Color</h6>
                <div class="color" id="outline-color-input-text">{{scheme.outline}}</div>
            </div>
        </div>


        <h4>Цвет текста</h4>
        <div class="color-wrapper">
            <input type="color" class="colorsss" id="button-text-color-input" value="{{scheme.button_font}}">
            <div class="color-description">
                <h6>Color</h6>
                <div class="color" id="button-text-color-input-text">{{scheme.button_font}}</div>
            </div>
        </div>
    </div>

    <h3>Шрифты</h3>
    <div class="card">
        Шрифт
        <div class="color-wrapper">
            <div class="font-square">Aa</div>
            <div class="font-name">Raleway</div>
        </div>


        Цвет
        <div class="color-wrapper">
            <input type="color" class="colorsss" id="font-color-input" value="{{scheme.font}}">
            <div class="color-description">
                <h6>Color</h6>
                <div class="color" id="font-color-input-text">{{scheme.font}}</div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
{% if scheme == None %}
<script src="{% static 'scripts/colors_welcome.js' %}"></script>
{% else %}
{% csrf_token %}
<script>
    
    document.querySelector(".ava-circle").setAttribute('style', `width:calc(${document.querySelector(".ava-circle").clientHeight}px - 4rem);height:calc(${document.querySelector(".ava-circle").clientHeight}px - 4rem)`)
    const csrf = document.getElementsByName('csrfmiddlewaretoken')[0].value

    const username = document.getElementById('username')
    const description = document.getElementById('about')

    const outlinedSelector = document.querySelector(".outlined-selector");

    function changeColor(elemId, value){
        console.log(elemId, `${elemId}-text`);
        document.querySelector(`#${elemId}-text`).innerHTML = value;
        fetch("/profile/design/change/color/", {
            method: "POST",
            body: JSON.stringify({
                color_id:elemId,
                color_hash:value
            }),
            headers: {
                "Content-Type": "application/json",
                'X-CSRFToken': csrf
            },
            });
    }

    function changeName(){
        document.querySelector('avaname').innerHTML = username.value[0].toUpperCase()
        fetch("/profile/change/", {
            method: "POST",
            body: JSON.stringify({
                name:username.value,
                about:description.value
            }),
            headers: {
                "Content-Type": "application/json",
                'X-CSRFToken': csrf
            },
            });
    }
    
    function changeButton(element, send) {
        outlinedSelector.style.top = element.offsetTop - 7 + "px";
        outlinedSelector.style.left = element.offsetLeft - 7 + "px";
        outlinedSelector.style.width = element.clientWidth + 10 + "px";
        outlinedSelector.style.height = element.clientHeight + 10 + "px";
        if (!send) {return}
        fetch("/profile/design/change/button/", {
            method: "POST",
            body: JSON.stringify({
                button_id:element.id,
            }),
            headers: {
                "Content-Type": "application/json",
                'X-CSRFToken': csrf
            },
            });
    }

    document.querySelectorAll('.color-description').forEach(inputElement => {
        inputElement.setAttribute('style', `width:${inputElement.clientHeight}px`)
        })
    colors = document.querySelectorAll('input[type=color]')
    colors.forEach(inputElement => {
        inputElement.addEventListener('blur', () => {
          changeColor(inputElement.id, inputElement.value)
      });
    });

    username.addEventListener('blur', () => {changeName()})
    description.addEventListener('blur', () => {changeName()})

    document.querySelectorAll('.s').forEach(inputElement => {
        inputElement.addEventListener('click', () => {changeButton(inputElement, true)})
    })

    changeButton(document.getElementById('s{{scheme.button_type}}-{{scheme.button_shape}}'), false);
</script>

{% endif %}
{% endblock %}